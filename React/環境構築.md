# 環境構築

```bash
touch Dockerfile compose.yml
```

```
# Dockerfile
FROM node:22

WORKDIR /app

COPY . /app
```

```yml
# compose.yml
services:
  app:
    build: .
    ports:
      - "5173:5173"
    volumes:
      - .:/app
      - ./node_modules:/app/node_modules
    environment:
      - CHOKIDAR_USEPOLLING=true
    command: bash -c "npm install && npm run dev -- --host"
```

```bash
docker compose build
```

```bash
docker compose run --rm app npm create vite@latest . -- --template react-ts
```

```bash
docker compose run --rm app npm install
```

```bash
docker compose up
```

## VSCode

この構成はDevcontainer起動時にReactサーバが起動している前提で、
Launch Chrome (Docker)を実行するとchromeが起動してデバッグが可能になる。

```json
# .devcontainer/devcontainer.json
{
  "name": "syoku_shindan",
  "dockerComposeFile": ["../docker-compose.yml"],
  "service": "app",
  "workspaceFolder": "/app",
  "memoryLimit": "4GB",
  "features": {
    "ghcr.io/anthropics/devcontainer-features/claude-code:1.0": {}
  },
  "remoteEnv": {
    "NODE_ENV": "development",
    "CHOKIDAR_USEPOLLING": "true"
  },
  "customizations": {
    "vscode": {
      "settings": {
        "extensions.verifySignature": false,
        
        // TypeScript全般設定
        "typescript.preferences.includePackageJsonAutoImports": "auto",
        "typescript.suggest.autoImports": true,
        "typescript.updateImportsOnFileMove.enabled": "always",
        
        // 言語別設定
        "[typescript]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode",
          "editor.formatOnSave": true,
          "editor.codeActionsOnSave": {
            "source.fixAll.eslint": "explicit",
            "source.organizeImports": "explicit"
          }
        },
        
        "[typescriptreact]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode",
          "editor.formatOnSave": true,
          "editor.codeActionsOnSave": {
            "source.fixAll.eslint": "explicit",
            "source.organizeImports": "explicit"
          }
        },
        
        "[json]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode",
          "editor.formatOnSave": true
        },
        
        // ESLint設定
        "eslint.validate": ["typescript", "typescriptreact"],
        "eslint.format.enable": true,
        
        // Emmet設定
        "emmet.includeLanguages": {
          "typescript": "html",
          "typescriptreact": "html"
        },
        "emmet.triggerExpansionOnTab": true,
        
        // ファイル管理
        "files.exclude": {
          "**/node_modules": true,
          "**/.git": true,
          "**/.DS_Store": true,
          "**/dist": true,
          "**/build": true
        }
      },
      "extensions": [
        "ms-vscode.vscode-typescript-next",
        "bradlc.vscode-tailwindcss", 
        "esbenp.prettier-vscode",
        "dbaeumer.vscode-eslint",
        "formulahendry.auto-rename-tag",
        "christian-kohler.path-intellisense",
        "ms-vscode.vscode-json",
        "saoudrizwan.claude-dev",
        "streetsidesoftware.code-spell-checker",
        "mhutchie.git-graph",
        "eamodio.gitlens",
        "oderwat.indent-rainbow",
        "humao.rest-client",
        "shardulm94.trailing-spaces",
        "spmeesseman.vscode-taskexplorer",
        "ms-vscode.live-server",
        "yoavbls.pretty-ts-errors",
        "vscode-icons-team.vscode-icons",
        "ms-vscode.vscode-js-debug",
        "firefox-devtools.vscode-firefox-debug"
      ]
    }
  },
  "postCreateCommand": "npm install",
  "forwardPorts": [5173, 3000],
  "portsAttributes": {
    "5173": {
      "label": "Vite Dev Server",
      "onAutoForward": "notify"
    },
    "3000": {
      "label": "Preview Server",
      "onAutoForward": "notify"
    }
  },
  "shutdownAction": "stopCompose"
}
```

```json
.vscode/extensions.json
{
  "recommendations": ["ms-vscode-remote.vscode-remote-extensionpack"]
}
```

```json
.vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch Chrome (Docker)", //Chromeブラウザを起動してアプリにアクセス
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:5173",
      "webRoot": "/app/src",
      "userDataDir": "/tmp/chrome-debug-profile",
      "sourceMapPathOverrides": {
        "webpack:///./src/*": "/app/src/*",
        "/./*": "/app/*"
      },
      "trace": true
    },
    {
      "name": "Debug React Component",
      "type": "chrome",
      "request": "launch", 
      "url": "http://localhost:5173",
      "webRoot": "/app/src",
      "breakOnLoad": true,
      "sourceMapPathOverrides": {
        "webpack:///./src/*": "/app/src/*"
      }
    },
    {
      "name": "Debug Vite (Docker)",
      "type": "node",
      "request": "launch",
      "program": "/app/node_modules/.bin/vite",
      "args": ["--mode", "development", "--host"],
      "env": {
        "NODE_ENV": "development"
      },
      "cwd": "/app",
      "console": "integratedTerminal"
    },
    {
      "name": "Debug Tests (Docker)",
      "type": "node",
      "request": "launch",
      "program": "/app/node_modules/.bin/vitest",
      "args": ["run", "--reporter=verbose"],
      "env": {
        "NODE_ENV": "test"
      },
      "cwd": "/app",
      "console": "integratedTerminal"
    }
  ]
}
```

```json
.vscode/tasks.json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Vite Dev Server",
      "type": "shell",
      "command": "npm",
      "args": ["run", "dev"],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "isBackground": true,
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "focus": false,
        "echo": true,
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": "^\\s*(\\S.*?):(\\d+):(\\d+)\\s*-\\s*(error|warning|info)\\s*(.*)$",
              "file": 1,
              "line": 2,
              "column": 3,
              "severity": 4,
              "message": 5
            }
          ],
          "background": {
            "activeOnStart": true,
            "beginsPattern": "^\\s*Local:\\s*http://",
            "endsPattern": "^\\s*ready in \\d+ms\\.$"
          }
        }
      ]
    },
    {
      "label": "Build Production",
      "type": "shell",
      "command": "npm",
      "args": ["run", "build"],
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": false
      },
      "problemMatcher": [
        {
          "pattern": [
            {
              "regexp": "^\\s*(\\S.*?):(\\d+):(\\d+)\\s*-\\s*(error|warning|info)\\s*(.*)$",
              "file": 1,
              "line": 2,
              "column": 3,
              "severity": 4,
              "message": 5
            }
          ]
        }
      ]
    },
    {
      "label": "Preview Build",
      "type": "shell",
      "command": "npm",
      "args": ["run", "preview"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "focus": false
      },
      "dependsOn": "Build Production"
    },
    {
      "label": "Lint",
      "type": "shell",
      "command": "npm",
      "args": ["run", "lint"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": false
      },
      "problemMatcher": [
        {
          "owner": "eslint",
          "pattern": [
            {
              "regexp": "^([^\\s].*):(\\d+):(\\d+):\\s+(warning|error)\\s+(.*)\\s\\s+(.*)$",
              "file": 1,
              "line": 2,
              "column": 3,
              "severity": 4,
              "message": 5,
              "code": 6
            }
          ]
        }
      ]
    },
    {
      "label": "Lint Fix",
      "type": "shell",
      "command": "npm",
      "args": ["run", "lint", "--", "--fix"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": false
      }
    },
    {
      "label": "Type Check",
      "type": "shell",
      "command": "npx",
      "args": ["tsc", "--noEmit"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": false
      },
      "problemMatcher": [
        {
          "owner": "typescript",
          "pattern": [
            {
              "regexp": "^([^\\s].*)\\((\\d+),(\\d+)\\):\\s+(error|warning|info)\\s+(TS\\d+)\\s*:\\s*(.*)$",
              "file": 1,
              "line": 2,
              "column": 3,
              "severity": 4,
              "code": 5,
              "message": 6
            }
          ]
        }
      ]
    },
    {
      "label": "Install Dependencies",
      "type": "shell",
      "command": "npm",
      "args": ["install"],
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": false
      }
    },
    {
      "label": "Clean Build",
      "type": "shell",
      "command": "rm",
      "args": ["-rf", "dist", "node_modules/.vite"],
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": false
      }
    }
  ]
}
```

## ディレクトリ構成

```bash
mkdir -p src/features/tasks/{components,containers,hooks,styles} \
         src/shared/{components,hooks,utils} \
         src/pages/home \
         src/pages/tasks \
         src/styles \
         src/types
```

## React Router

利用する場合のみ

```bash
npm install react-router-dom@7
```

## Tailwind

```bash
npm install tailwindcss @tailwindcss/vite
```

```css
# src/index.css
@import "tailwindcss";
```

```ts
// vite.config.ts
import tailwindcss from "@tailwindcss/vite";
```



