# Singleton パターン

## 1. パターンの目的

Singletonパターンは、**クラスのインスタンスがプログラム全体で「たった1つ」しか存在しないことを保証する**パターンです。

解決する問題：

- システム全体で共有すべきリソース（設定、ログ、接続プール等）が複数作られてしまう問題
- グローバル変数を使わずに、唯一のインスタンスへのアクセスポイントを提供したい

## 2. どんな時に使うか

| 場面             | 具体例                                                |
| ---------------- | ----------------------------------------------------- |
| 設定管理         | アプリケーション設定を一元管理                        |
| ログ出力         | 複数箇所から同じログファイルに書き込む                |
| データベース接続 | コネクションプールの管理                              |
| キャッシュ       | メモリキャッシュの共有                                |
| ハードウェア制御 | プリンター、シリアルポートなど物理的に1つしかないもの |

## 3. 登場人物（クラス構成）

```
┌─────────────────────────────────────┐
│           Singleton                 │
├─────────────────────────────────────┤
│ - instance: Singleton  [static]     │  ← 唯一のインスタンスを保持
├─────────────────────────────────────┤
│ - Singleton()          [private]    │  ← 外部からnewできない
│ + GetInstance(): Singleton [static] │  ← インスタンス取得の窓口
├─────────────────────────────────────┤
│ + その他のメソッド()                  │
└─────────────────────────────────────┘
```

**Singleton（シングルトン）役**

- 唯一のインスタンスを返す`GetInstance`メソッドを持つ
- コンストラクタを`private`にして外部からのインスタンス生成を禁止

## 4. C#での実装例

### 基本実装（書籍に近い形）

csharp

```csharp
/// <summary>
/// 基本的なSingletonパターンの実装
/// ※シングルスレッド環境向け
/// </summary>
public class Singleton
{
    // 唯一のインスタンスを保持する静的フィールド
    private static Singleton? _instance;

    // privateコンストラクタ - 外部からnewできない
    private Singleton()
    {
        Console.WriteLine("インスタンスを生成しました");
    }

    // インスタンス取得のための静的メソッド
    public static Singleton GetInstance()
    {
        // まだインスタンスがなければ作成
        if (_instance == null)
        {
            _instance = new Singleton();
        }
        return _instance;
    }

    public void DoSomething()
    {
        Console.WriteLine("Singletonのメソッドが呼ばれました");
    }
}
```