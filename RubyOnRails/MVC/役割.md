# Rails MVCパターンにおける責務の区分け

| コンポーネント                | 主な責務                                                     | 実装例                                                       | 実装すべきでないもの                                         |
| ----------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **モデル (Model)**            | • データベースとのやり取り<br>• ビジネスロジックの実装<br>• データの検証・バリデーション<br>• モデル間の関連付け<br>• スコープの定義<br>• コールバックの処理 | • `belongs_to`/`has_many` 関連付け<br>• `validates` によるバリデーション<br>• カスタムスコープ定義<br>• ビジネスルールに基づくメソッド<br>• モデル固有の計算ロジック<br>• データ整合性を保つメソッド | • HTTPリクエスト処理<br>• ビュー生成ロジック<br>• HTML生成<br>• セッション管理<br>• ルーティング関連の処理 |
| **コントローラ (Controller)** | • HTTPリクエストの処理<br>• パラメータの取得と検証<br>• 認証・認可の確認<br>• モデルの呼び出し<br>• リダイレクトとレンダリングの決定<br>• フラッシュメッセージの設定 | • `params`からのデータ取得<br>• 基本的なCRUD操作<br>• `before_action`フィルター<br>• `redirect_to`/`render`の決定<br>• 認証チェック<br>• 簡単なクエリの実行 | • 複雑なビジネスロジック<br>• HTML生成<br>• 表示用フォーマット処理<br>• 複雑なデータクエリ<br>• 再利用可能なUI要素の生成 |
| **ビュー (View)**             | • HTMLマークアップの定義<br>• データの表示<br>• フォームの構築<br>• レイアウトの構成<br>• 部分テンプレートの管理 | • ERB/HAMLテンプレート<br>• `form_with`によるフォーム<br>• 条件付き表示<br>• レイアウト構成<br>• コレクションの繰り返し表示 | • 複雑なデータ処理<br>• ビジネスロジック<br>• 複雑な条件分岐<br>• データベースクエリ<br>• 認証・認可ロジック |
| **ヘルパー (Helper)**         | • ビュー表示のためのロジック<br>• HTMLの生成・整形<br>• 表示用データのフォーマット<br>• 条件付き表示ロジック<br>• 再利用可能なビューコンポーネント | • リンク生成ヘルパー<br>• 日付/時間/数値のフォーマット<br>• アクティブなメニュー項目の判定<br>• 共通UI要素の生成<br>• 権限に基づく表示制御 | • モデル関連のビジネスロジック<br>• 複雑なデータ処理<br>• コントローラの責務<br>• データベース操作<br>• 認証ロジック |
| **サービスオブジェクト**      | • 複雑なビジネスロジック<br>• 複数モデルにまたがる処理<br>• 外部APIとの連携<br>• トランザクション処理<br>• バッチ処理 | • 注文処理サービス<br>• PDFレポート生成<br>• データインポート/エクスポート<br>• 決済処理<br>• 複雑な検索/集計 | • 単純なCRUD操作<br>• ビューロジック<br>• ルーティング関連の処理<br>• シンプルなモデル操作 |
| **コンサーン (Concern)**      | • 複数のモデル/コントローラ間で共有されるロジック<br>• 横断的な関心事の分離<br>• コードの再利用性向上 | • タグ付け可能なモデル処理<br>• ソフトデリート機能<br>• 監査ログ記録<br>• 検索機能の共通実装<br>• ステータス管理 | • モデル/コントローラ固有の処理<br>• 関連性の低いコードの混在<br>• 過度に肥大化した実装 |