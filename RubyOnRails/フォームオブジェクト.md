# フォームオブジェクト

ユーザの入力の整形や永続化をコントローラだけで行うと、コントローラが肥大化してしまいます。 
この原因はコントローラがモデル層の知識をもちすぎるためにあります。 
このときビューもフォームを表示するための知識をもつことになるため、コントローラと同じような問題が起こってしまいます。 
このことは単一責任の原則に反し、**モデル層の変更がコントローラやビューに影響を及ぼす**ことになります。
逆にActiveRecordモデルにこういった責務をもたせると、今度はActiveRecordモデルがフォームの知識を持ちすぎてしまいます。 
フォームという独立した責務があるのであれば、これをひとつのクラスにカプセル化する、
というのがフォームオブジェクトの役割です。

以下は通常のUserモデルだけでは、CSVの取り込みに対応できない。
厳密には出来るが、Userモデルにその処理を入れると肥大化する。

```ruby
class UserResistrationForm
  include AdtiveModel::Model
  include AdtiveModel::Attributes
  
  attribute :email, :string
  attribute :password, :string
  attribute :password_confirmation, :string
  
  validates :email, format: {with: URI::MailTo::EMAIL_REGEXP}
  validate :email_is_not_taken_by_another
  validate :password, format: {with: ～ },
                      confirmation: { allow_brank: true}
  validates :terms_of_service, acceptance: { allow_nil: false }
  
  def save
    return false if invalid?
    
    user.save!
    UserMailer.with(user: user).welcome.deliver_later
    
    true
  end
  
  
  def user
    @user ||= User.new(email: email, password: password)
  end
  
  private
  
  def email_is_not_token_by_another
    errors.add(:email, :token, value: email) if User.exits?(email: email)
  end
end
```

